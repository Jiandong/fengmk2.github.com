<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="description" content="MK2's blog，生命是一场幻觉，代码是一段人生。"/>
  <link rel="stylesheet" href="http://typo.sofish.de/typo.css" />
  <link rel="stylesheet" href="http://fengmk2.github.com/css/prettify.css" />
  <script src="http://fengmk2.github.com/js/jquery-1.7.min.js"></script>
  <script src="http://fengmk2.github.com/js/prettify.js"></script>
  <title>fibonacci(40) benchmark</title>
  <style>
     a{color:#09f;}
     code{color:#080;}
     pre{line-height: 1.4;}
     h1, #tagline{display:inline;}
     #wrapper{padding:5% 8%;min-width:480px;}
     #tagline{font:0.8em serif;color:#888;display:inline-block;margin:0.1em 0 1.2em;}
     #fork{position:fixed;top:0;right:0;_position:absolute;}
  </style>
</head>
<body>

<div id="wrapper" class="typo">

<div id="header">
<h3><a href="/">Home</a> | <a href="../">Prev</a></h3>
</div> <!-- #header -->

<div id="content">
<h1>fibonacci(40) benchmark</h1>
<p><a href="http://teddziuba.com/2011/10/node-js-is-cancer.html">Node.js is Cancer</a> show a wrong way to use nodejs.
But the test code <strong><a href="http://en.wikipedia.org/wiki/Fibonacci">Fibonacci</a></strong> is so funny.
I implement the <strong>fibonacci function</strong> in other <strong><a href="http://en.wikipedia.org/wiki/Dynamic_programming_language">Dynamic Languages</a></strong> for comparison testing.

</p>
<h2>Languages</h2>
<h3>Dynamic</h3>
<ul>
<li><a href="http://nodejs.org">nodejs</a></li>
<li><a href="http://kkaefer.github.com/node-cpp-modules">nodejs + cpp module</a></li>
<li><a href="http://python.org">python</a></li>
<li><a href="http://pypy.org/">pypy</a>: a fast, compliant alternative implementation of the Python language. </li>
<li><a href="http://perl.org">perl</a> </li>
<li><a href="http://www.php.net/">php</a></li>
<li><a href="http://www.ruby-lang.org/">ruby</a></li>
<li><a href="http://www.lua.org/">lua</a></li>
<li><a href="http://luajit.org/">luajit</a>: a Just-In-Time Compiler for Lua.</li>
</ul>
<h3>Static</h3>
<ul>
<li><a href="http://en.wikipedia.org/wiki/C_programming_language">c</a></li>
<li><a href="http://golang.org/">go</a></li>
</ul>
<p>If you want to help add more dynamic languagues, please leave the <strong>implement code</strong> in comments.

</p>
<h2>Results</h2>
<p>(^_^) c &gt; java &gt; go &gt; luajit &gt; nodejs &gt; pypy &gt; lua &gt; python &gt; php &gt; perl &gt; ruby (T_T)

</p>
<table>
  <tr><th>Language</th><th>Times (user)</th><th>Position</th><th>Version</th></tr>
  <tr>
    <td style="color: green;">c with -O2</td><td>0m0.187s</td><td>#0</td>
    <td>i686-apple-darwin11-llvm-gcc-4.2 (GCC) 4.2.1 <br/>
      (Based on Apple Inc. build 5658) (LLVM build 2336.11.00)
    </td>
  </tr>
  <tr>
    <td style="color: green;">node + cpp module</td><td>0m1.417s</td><td>#1</td>
    <td>v0.8.8, gcc -O2</td>
  </tr>
  <tr>
    <td style="color: green;">go</td><td>0m1.275s</td><td>#2</td>
    <td>Java(TM) SE Runtime Environment (build 1.6.0_35-b10-428-11M3811)<br/>
      Java HotSpot(TM) 64-Bit Server VM (build 20.10-b01-428, mixed mode)
    </td>
  </tr>
  <tr>
    <td style="color: green;">go</td><td>0m1.664s</td><td>#3</td>
    <td>go version go1.0.2</td>
  </tr>
  <tr>
    <td style="color: green;">luajit</td><td>0m2.463s</td><td>#4</td>
    <td>LuaJIT 2.0.0-beta10 -- Copyright (C) 2005-2012 Mike Pall.</td>
  </tr>
  <tr>
    <td style="color: green;">nodejs</td><td>0m2.826s</td><td>#5</td>
    <td>v0.8.8</td>
  </tr>
  <tr>
    <td>pypy</td><td>0m29.650s</td><td>#6</td>
    <td>Python 2.7.2 (341e1e3821ff, Jun 07 2012, 15:42:54) [PyPy 1.9.0 with GCC 4.2.1]</td>
  </tr>
  <tr>
    <td>lua</td><td>0m42.944s</td><td>#7</td>
    <td>Lua 5.1.4 Copyright (C) 1994-2008 Lua.org, PUC-Rio</td>
  </tr>
  <tr>
    <td style="color: red;">python</td><td>1m19.029s</td><td>#8</td>
    <td>Python 2.7.2</td>
  </tr>
  <tr>
    <td style="color: red;">php</td><td>1m43.355s</td><td>#9</td>
    <td>PHP 5.3.13 with Suhosin-Patch (cli) (built: Jun 20 2012 17:05:20)</td>
  </tr>
  <tr>
    <td style="color: red;">perl</td><td>2m30.444s</td><td>#10</td>
    <td>This is perl 5, version 12, subversion 4 (v5.12.4) built for darwin-thread-multi-2level</td>
  </tr>
  <tr>
    <td style="color: red;">ruby</td><td>3m32.074s</td><td>#11</td>
    <td>ruby 1.8.7 (2012-02-08 patchlevel 358) [universal-darwin12.0]</td>
  </tr>
</table>

<p><strong>lua</strong> use <em>local function</em> will get better performance.

</p>
<h2>fibonacci(40) benchmark result:</h2>
<h3>c</h3>
<p>i686-apple-darwin11-llvm-gcc-4.2 (GCC) 4.2.1 (Based on Apple Inc. build 5658) (LLVM build 2336.11.00)

</p>
<pre><code class="lang-c">#include &lt;stdio.h&gt;

int fibonacci(n) {
  if (n &lt; 2) {
    return 1;
  }
  return fibonacci(n - 2) + fibonacci(n - 1);
}

int main() {
  printf(&quot;%d\n&quot;, fibonacci(40));
  return 0;
}</code></pre>
<p>gcc -O0

</p>
<pre><code class="lang-bash">165580141

real  0m3.908s
user  0m3.884s
sys 0m0.004s</code></pre>
<p>gcc -O1

</p>
<pre><code class="lang-bash">165580141

real  0m1.783s
user  0m1.773s
sys 0m0.003s</code></pre>
<p>gcc -O2

</p>
<pre><code class="lang-bash">165580141

real  0m0.192s
user  0m0.185s
sys 0m0.002s</code></pre>
<p>gcc -O3

</p>
<pre><code class="lang-bash">165580141

real  0m0.199s
user  0m0.187s
sys 0m0.002s</code></pre>
<h3>java</h3>
<p>java version &quot;1.6.0_35&quot;
Java(TM) SE Runtime Environment (build 1.6.0_35-b10-428-11M3811)
Java HotSpot(TM) 64-Bit Server VM (build 20.10-b01-428, mixed mode)

</p>
<pre><code class="lang-java">public class Fibonacci {
  public static int fib(int n) {
    if (n &lt; 2) {
      return 1;
    } else {
     return fib(n - 1) + fib(n - 2);
    }
  }

  public static void main(String[] args) {
    System.out.print(fib(40) + &quot;\n&quot;);
  }
}</code></pre>
<pre><code class="lang-bash">165580141

real  0m1.434s
user  0m1.275s
sys 0m0.059s</code></pre>
<h3>go</h3>
<p>go version go1.0.2

</p>
<pre><code class="lang-go">package main

import &quot;fmt&quot;

func fibonacci(n int) int{
  if (n &lt; 2) {
    return 1
  }
  return fibonacci(n - 2) + fibonacci(n - 1)
}

func main() {
  fmt.Println(fibonacci(40))
}</code></pre>
<pre><code class="lang-bash">165580141

real  0m1.686s
user  0m1.666s
sys 0m0.004s</code></pre>
<h3>nodejs</h3>
<pre><code class="lang-js">function fibonacci(n) {
  if (n &lt; 2) {
    return 1;
  }
  return fibonacci(n - 2) + fibonacci(n - 1);
}

console.log(fibonacci(40));</code></pre>
<p>v0.4.12

</p>
<pre><code class="lang-bash">165580141

real  0m7.252s
user  0m7.211s
sys 0m0.018s</code></pre>
<p>v0.6.20

</p>
<pre><code class="lang-bash">165580141

real  0m5.152s
user  0m5.127s
sys 0m0.027s</code></pre>
<p>v0.8.8

</p>
<pre><code class="lang-bash">165580141

real  0m2.894s
user  0m2.826s
sys 0m0.020s</code></pre>
<h3>nodejs + cpp module</h3>
<pre><code class="lang-js">var fibonacci = require(&#39;./build/Release/cppfibonacci&#39;).fibonacci;
console.log(fibonacci(40));</code></pre>
<p>waf 1.5.16 (7610:7647M)
v0.4.12

</p>
<pre><code class="lang-bash">165580141

real  0m1.474s
user  0m1.427s
sys 0m0.015s</code></pre>
<p>waf 1.5.16 (7610:7647M)
v0.6.20

</p>
<pre><code class="lang-bash">165580141

real  0m1.444s
user  0m1.420s
sys 0m0.013s</code></pre>
<p>waf 1.5.16 (7610:7647M)
v0.8.8

</p>
<pre><code class="lang-bash">165580141

real  0m1.436s
user  0m1.417s
sys 0m0.014s</code></pre>
<h3>luajit</h3>
<p>LuaJIT 2.0.0-beta10 -- Copyright (C) 2005-2012 Mike Pall. <a href="http://luajit.org/">http://luajit.org/</a>

</p>
<pre><code class="lang-lua">function fibonacci(n)
  if n &lt; 2 then
    return 1
  end
  return fibonacci(n - 2) + fibonacci(n - 1)
end

io.write(fibonacci(40), &quot;\n&quot;)</code></pre>
<pre><code class="lang-bash">165580141

real  0m2.582s
user  0m2.547s
sys 0m0.005s</code></pre>
<p>using &#39;local&#39;

</p>
<pre><code class="lang-lua">local function fibonacci(n)
  if n &lt; 2 then
    return 1
  end
  return fibonacci(n - 2) + fibonacci(n - 1)
end

io.write(fibonacci(40), &quot;\n&quot;)</code></pre>
<pre><code class="lang-bash">165580141

real  0m2.470s
user  0m2.463s
sys 0m0.003s</code></pre>
<h3>pypy</h3>
<p>Python 2.7.2 (341e1e3821ff, Jun 07 2012, 15:42:54)
[PyPy 1.9.0 with GCC 4.2.1]

</p>
<pre><code class="lang-py">def fibonacci(n):
    if n &lt; 2:
        return 1
    return fibonacci(n - 2) + fibonacci(n - 1)

print fibonacci(40)</code></pre>
<pre><code class="lang-bash">165580141

real  0m30.819s
user  0m29.650s
sys 0m0.196s</code></pre>
<h3>lua</h3>
<p>Lua 5.1.4  Copyright (C) 1994-2008 Lua.org, PUC-Rio

</p>
<pre><code class="lang-lua">function fibonacci(n)
  if n &lt; 2 then
    return 1
  end
  return fibonacci(n - 2) + fibonacci(n - 1)
end

io.write(fibonacci(40), &quot;\n&quot;)</code></pre>
<pre><code class="lang-bash">165580141

real  0m44.095s
user  0m42.944s
sys 0m0.101s</code></pre>
<p>using &#39;local&#39;

</p>
<pre><code class="lang-lua">local function fibonacci(n)
  if n &lt; 2 then
    return 1
  end
  return fibonacci(n - 2) + fibonacci(n - 1)
end

io.write(fibonacci(40), &quot;\n&quot;)</code></pre>
<pre><code class="lang-bash">165580141

real  0m38.479s
user  0m37.655s
sys 0m0.082s</code></pre>
<h3>python</h3>
<p>Python 2.7.2

</p>
<pre><code class="lang-py">def fibonacci(n):
    if n &lt; 2:
        return 1
    return fibonacci(n - 2) + fibonacci(n - 1)

print fibonacci(40)</code></pre>
<pre><code class="lang-bash">165580141

real  1m21.027s
user  1m19.029s
sys 0m0.200s</code></pre>
<h3>php</h3>
<p>PHP 5.3.13 with Suhosin-Patch (cli) (built: Jun 20 2012 17:05:20) 

</p>
<pre><code class="lang-php">&lt;?php
function fibonacci($n) {
  if ($n &lt; 2) {
    return 1;
  }
  return fibonacci($n - 2) + fibonacci($n - 1);
}
echo fibonacci(40).&quot;\n&quot;;
?&gt;</code></pre>
<pre><code class="lang-bash">165580141

real  1m46.118s
user  1m43.355s
sys 0m0.250s</code></pre>
<h3>perl</h3>
<p>This is perl 5, version 12, subversion 4 (v5.12.4) built for darwin-thread-multi-2level

</p>
<pre><code class="lang-perl">sub fibonacci {
  my $n = shift;
  if ($n &lt; 2) {
    return 1;
  }
  return fibonacci($n - 2) + fibonacci($n - 1);
}
print fibonacci(40), &quot;\n&quot;;</code></pre>
<pre><code class="lang-bash">165580141

real  2m33.350s
user  2m30.444s
sys 0m0.340s</code></pre>
<h3>ruby</h3>
<p>ruby 1.8.7 (2012-02-08 patchlevel 358) [universal-darwin12.0]

</p>
<pre><code class="lang-ruby">def fibonacci(n)
  if n &lt; 2
    return 1
  end
  return fibonacci(n - 2) + fibonacci(n - 1)
end

puts fibonacci(40)</code></pre>
<pre><code class="lang-bash">165580141

real  3m37.177s
user  3m32.074s
sys 0m0.507s</code></pre>
<h2>Conclusion</h2>
<ul>
<li><strong>go</strong> is <strong>awsome</strong>!</li>
<li><strong>nodejs</strong> is <strong>FAST</strong>, v0.8+ is <strong>FASTER</strong>. </li>
<li><strong>luajit</strong> 2X faster than nodejs@0.6.x, <strong>Shocking</strong>.</li>
</ul>


<h2>Comments</h2>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'fengmk2github'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div> <!-- #content -->

<div id="footer">
</div> <!-- #footer -->

</div> <!-- #wrapper -->

<a href="https://github.com/fengmk2/mk2blog" id="fork">
    <img alt="Fork me on GitHub" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png">
</a>

<!-- Specific to this page -->
<script>
$(function() {
  $('pre code').parent().addClass('prettyprint');
  prettyPrint();
});
</script>
</body>
</html>
